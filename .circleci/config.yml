version: 2.1

executors:
  docker-executor:
    machine:
      image: ubuntu-2204:2022.04.2

jobs:
  build:
    executor: docker-executor
    steps:
      - checkout
      - run: |
          echo "$DOCKERHUB_PASSWORD" | docker login --username $DOCKERHUB_USERNAME --password-stdin
          docker run -d --name db company/proprietary-db:1.2.3
      - run: docker build -t company/app:$CIRCLE_BRANCH .

      - run: docker push company/app:$CIRCLE_BRANCH
    
workflows:
  version: 2
  build_and_push:
    jobs:
      - build

